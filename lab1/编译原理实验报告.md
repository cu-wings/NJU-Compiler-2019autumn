# <center>编译原理实验报告</center>

<center>171860570_周吴成，161220144向扬帆</center>
### 1.实验目标

使用词法分析工具GNU Flex和语法分析工具GNU Bison完成一个具有词法分析和语法分析功能的程序。

### 2.实验内容

1. 词法分析部分
   + 首先需要实现的是用于识别词法单元的正则表达式，实验手册的附录中已经提供了绝大多数的词法单元表达式，需要实现的只有INT、FLOAT、ID，我们的小组由于选做1.1，因此需要对INT做特殊处理。
   + 表示INT的正则表达式如下：{hexhead}{hexbody}\*|{dechead}{decbody}\*|{octhead}{octbody}\*，INT被分为十进制数、16进制数和8进制数3种情况，将其头和剩余部分分开表示，剩余部分字符出现0或若干次。为了实现对错误的16进制数或8进制数的判断，我们选择使用正则表达式来匹配错误的INT型数。其形式如下：{dechead}{decbody}\*{nondecbody}+{decbody}\*。16进制数以此类推。
   + 由于无需对float和注释做特殊处理，在此不再叙述相关的实现方法。
2. 语法分析部分
   + 完成词法分析后，根据实验手册，首先在syntax.y文件中include ”lex.yy.c“，在lexical.l文件中include "syntax.tab.h"。此时在syntax.y中定义所有的token，然后让lexical.l中识别到的词法单元返回至syntax.y，此时bison便可以使用flex中识别到的词法单元了。在syntax.y中输入附录中的c--文法，按照实验手册的说明修改main函数，此时的程序便已经可以判断是否有语法错误了。
   
   + 按照附录中各个操作的优先级和结合性，在syntax.y中对对应的token进行定义结合性和优先级，最终的结果如下：
     <img src="D:\课件\作业\大三上\编译原理\实验一\优先级和结合性.png" alt="优先级和结合性" style="zoom: 67%;" />
   
     其中EMPTY代表空串，实际上并没有作用。
   
   + 定义优先级和结合性之后，基本上完成了对于二义性的处理，剩余有1个冲突，查看output文件，发现是if-else的结合问题，按照实验手册上的说明完成对于其冲突的处理，此时便已经完成了对于冲突的处理。
   
   + 接下来需要建立语法树，考虑到语法树是一颗多叉树，且在语法分析中一次插入根的子节点的数目不定，因此考虑使用变长参数的函数。
   
   + 树结构如下：![树结构](D:\课件\作业\大三上\编译原理\实验一\树结构.png)
   
     其中使用了联合类型存储可能有的INT、FLOAT、ID的值。line是此词法单元第一次出现的行号，is_terminal代表其是否为终结符，name为其类型名称。
   
   + 在每个非终结符的展开式后进行建树的语义操作，形式如下：![展开式](D:\课件\作业\大三上\编译原理\实验一\展开式.png)
   
     这里注意需要对空语句复制为NULL，否则会出错。
   
   + 回到lexical.l中，我们需要对YYSTYPE重新定义使其能够向bison传输语法树结构的值，将YYSTYPE定义为treeNode*，在词法分析中向yylval赋值，内容包括行号、类型名、参数值等。
   
     定义宏如下：![宏](D:\课件\作业\大三上\编译原理\实验一\宏.png)
   
   + 根据实验手册的做法，定义YY_USER_ACTION，使得其能够自动返回正确的行号。
   
   + 进行错误恢复处理，在ExtDef、Exp、Stmt、CompSt、Def中添加错误恢复同步。
   

3.其他

本小组为第10组，完成选做1.1部分。

编译方式与原本编译方式一致，Makefile文件中添加了scanner的伪目标。

### 3.小组成员

周吴成 171860570 邮箱：zwx847447133@126.com

向扬帆 161220144 邮箱：272338868@qq.com